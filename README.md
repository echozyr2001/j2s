# j2s - JSON to Multi-Language Code Generator

A fast, reliable command-line tool for generating JSON Schema files and multi-language struct definitions from JSON input files.

## Features

### Core Functionality
- **ÔøΩ Fastr & Efficient**: Optimized for performance with large files up to 100MB
- **ÔøΩ Mmulti-Language Support**: Generate code for Go, Rust, TypeScript, and Python
- **üìã JSON Schema Generation**: Follows JSON Schema Draft 2020-12 specification
- **ÔøΩ Smart lType Inference**: Automatically detects and maps JSON types to language-specific types

### Code Generation
- **üìù Intelligent Comments**: Auto-generates descriptive comments for fields and structures
- **üè∑Ô∏è Field Recognition**: Smart pattern matching for common field types (IDs, dates, emails, etc.)
- **üé® Language-Specific Formatting**: Follows each language's naming conventions and best practices
- **‚öôÔ∏è Configurable Output**: Control comment generation, struct names, and optional fields

### Performance & Reliability
- **üìä Progress Indication**: Shows progress for large files with detailed status updates
- **üèóÔ∏è Nested Structure Support**: Handles deeply nested objects and arrays with recursion depth limiting
- **üí° Helpful Error Messages**: Provides detailed error messages with suggestions for resolution
- **üõ°Ô∏è Robust Error Handling**: Comprehensive validation and error recovery

## Installation

### From Source

```bash
git clone https://github.com/echozyr2001/j2s
cd json2schema
cargo build --release
```

The binary will be available at `target/release/j2s`.

## Usage

### JSON Schema Generation (Default)

```bash
# Generate JSON Schema from JSON file
j2s data.json

# This creates data.schema.json in the same directory
```

### Multi-Language Code Generation

```bash
# Generate Go structs
j2s data.json --format go --output user.go

# Generate Rust structs
j2s data.json --format rust --output user.rs

# Generate TypeScript interfaces
j2s data.json --format typescript --output user.ts

# Generate Python dataclasses
j2s data.json --format python --output user.py
```

### Advanced Options

```bash
# Custom struct name
j2s data.json --format go --struct-name User --output models.go

# Disable comments
j2s data.json --format rust --no-comments --output types.rs

# Specify custom output path for schema
j2s data.json --output my-schema.json

# Short flags
j2s -i data.json -f go -o user.go
```

### Command Line Options

```bash
# Show help
j2s --help

# Show version
j2s --version

# Available formats
j2s --help | grep -A 10 "format"
```

#### Format Options
- `schema` (default): Generate JSON Schema
- `go`: Generate Go structs with JSON tags
- `rust`: Generate Rust structs with serde annotations
- `typescript` or `ts`: Generate TypeScript interfaces
- `python` or `py`: Generate Python dataclasses

## Examples

### Input JSON
```json
{
  "user_id": 12345,
  "name": "John Doe",
  "email": "john@example.com",
  "is_active": true,
  "created_at": "2023-12-25T10:30:00Z",
  "scores": [95, 87, 92],
  "profile": {
    "bio": "Software developer",
    "location": "San Francisco"
  }
}
```

### Generated Go Code
```go
// Code generated by j2s at 2025-08-16 07:34:47 UTC; DO NOT EDIT.
// This file was automatically generated from JSON data.

package main

// User represents the structure of the JSON data
type User struct {
    // user_id (int64): Unique identifier for the user
    UserId int64 `json:"user_id"`
    // name (string): Name or title
    Name string `json:"name"`
    // email (string): Email address
    Email string `json:"email"`
    // is_active (bool): Boolean flag
    IsActive bool `json:"is_active"`
    // created_at (string): Date/time value
    CreatedAt string `json:"created_at"`
    // scores ([]int64): Array of score items
    Scores []int64 `json:"scores"`
    // profile (Profile): Profile information
    Profile Profile `json:"profile"`
}

// Profile represents the structure of the JSON data
type Profile struct {
    // bio (string): Description text
    Bio string `json:"bio"`
    // location (string): Address information
    Location string `json:"location"`
}
```

### Generated Rust Code
```rust
//! Code generated by j2s at 2025-08-16 07:34:47 UTC; DO NOT EDIT.
//! This file was automatically generated from JSON data.

use serde::{Deserialize, Serialize};

/// User represents the structure of the JSON data
#[derive(Serialize, Deserialize, Debug, Clone)]
pub struct User {
    /// user_id (i64): Unique identifier for the user
    pub user_id: i64,
    /// name (String): Name or title
    pub name: String,
    /// email (String): Email address
    pub email: String,
    /// is_active (bool): Boolean flag
    pub is_active: bool,
    /// created_at (String): Date/time value
    pub created_at: String,
    /// scores (Vec<i64>): Array of score items
    pub scores: Vec<i64>,
    /// profile (Profile): Profile information
    pub profile: Profile,
}

/// Profile represents the structure of the JSON data
#[derive(Serialize, Deserialize, Debug, Clone)]
pub struct Profile {
    /// bio (String): Description text
    pub bio: String,
    /// location (String): Address information
    pub location: String,
}
```

### Generated TypeScript Code
```typescript
/**
 * Code generated by j2s at 2025-08-16 07:34:47 UTC; DO NOT EDIT.
 * This file was automatically generated from JSON data.
 */

/**
 * User represents the structure of the JSON data
 */
export interface User {
  /** user_id (number): Unique identifier for the user */
  user_id: number;
  /** name (string): Name or title */
  name: string;
  /** email (string): Email address */
  email: string;
  /** is_active (boolean): Boolean flag */
  is_active: boolean;
  /** created_at (string): Date/time value */
  created_at: string;
  /** scores (number[]): Array of score items */
  scores: number[];
  /** profile (Profile): Profile information */
  profile: Profile;
}

/**
 * Profile represents the structure of the JSON data
 */
export interface Profile {
  /** bio (string): Description text */
  bio: string;
  /** location (string): Address information */
  location: string;
}
```

### Generated JSON Schema
```json
{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "type": "object",
  "properties": {
    "user_id": { "type": "integer" },
    "name": { "type": "string" },
    "email": { "type": "string" },
    "is_active": { "type": "boolean" },
    "created_at": { "type": "string" },
    "scores": {
      "type": "array",
      "items": { "type": "integer" }
    },
    "profile": {
      "type": "object",
      "properties": {
        "bio": { "type": "string" },
        "location": { "type": "string" }
      },
      "required": ["bio", "location"]
    }
  },
  "required": ["user_id", "name", "email", "is_active", "created_at", "scores", "profile"]
}
```

## Performance

- **File Size Limits**: Supports files up to 100MB
- **Large File Handling**: Files >10MB show progress indicators
- **Array Optimization**: Large arrays (>10k items) use sampling for performance
- **Memory Efficient**: Optimized memory usage for large JSON structures
- **Recursion Safety**: Automatic depth limiting prevents stack overflow

## Type Mapping

### JSON to Language Types

| JSON Type | Go | Rust | TypeScript | Python | JSON Schema |
|-----------|----|----|------------|--------|-------------|
| `null` | `*T` | `Option<T>` | `T \| null` | `Optional[T]` | `null` |
| `boolean` | `bool` | `bool` | `boolean` | `bool` | `boolean` |
| `integer` | `int64` | `i64` | `number` | `int` | `integer` |
| `float` | `float64` | `f64` | `number` | `float` | `number` |
| `string` | `string` | `String` | `string` | `str` | `string` |
| `array` | `[]T` | `Vec<T>` | `T[]` | `List[T]` | `array` |
| `object` | `struct` | `struct` | `interface` | `@dataclass` | `object` |

### Smart Field Recognition

j2s automatically recognizes common field patterns and generates appropriate comments:

| Field Pattern | Example | Generated Comment |
|---------------|---------|-------------------|
| ID fields | `user_id`, `product_id` | "Unique identifier for the user/product" |
| Email fields | `email`, `email_address` | "Email address" |
| Date/Time fields | `created_at`, `timestamp` | "Date/time value" |
| Boolean flags | `is_active`, `has_permission` | "Boolean flag" |
| Status fields | `status`, `account_status` | "Status indicator" |
| Count fields | `total_count`, `item_count` | "Count or total value" |
| URL fields | `profile_url`, `website` | "URL or link" |
| Array fields | `tags`, `categories` | "Array of tag/category items" |

## Error Handling

j2s provides comprehensive error handling with helpful messages:

- **File not found**: Clear indication with path verification tips
- **Invalid JSON**: Syntax error details with common issue suggestions
- **Permission errors**: Specific guidance for file access issues
- **Large files**: Warnings and limits for performance protection

## Development

### Building

```bash
cargo build
```

### Testing

```bash
# Run all tests
cargo test

# Run with output
cargo test -- --nocapture

# Run specific test suite
cargo test cli_integration
```

### Linting

```bash
cargo clippy
```
